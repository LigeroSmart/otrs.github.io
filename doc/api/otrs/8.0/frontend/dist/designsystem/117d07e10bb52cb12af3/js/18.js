(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{GgUG:function(e,t,i){"use strict";i.r(t);i("2Tod"),i("ABKx"),i("asZ9"),i("9ovy"),i("DbwS"),i("75LO"),i("W1QL"),i("K/PF"),i("t91x");var o=i("OvAC"),r=i.n(o),s=i("rpZP"),n=i("9va6"),a=i("ihrN");function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,o)}return i}function c(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(i,!0).forEach(function(t){r()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var u={name:"Form",components:{CommonAlert:function(){return i.e(297).then(i.bind(null,"L3zo"))},FormGroup:function(){return Promise.all([i.e(38),i.e(323)]).then(i.bind(null,"yFPx"))},CommonCollisionDetectionMessage:function(){return i.e(88).then(i.bind(null,"JKnt"))}},mixins:[s.a],props:{url:{type:String},xhr:{type:Boolean,default:!1},params:{type:Object},propOverride:{type:Object},testMode:{type:Boolean,default:!1},noAutofocus:{type:Boolean,default:!1},hideDescription:{type:Boolean,default:!1},filterText:{type:String},enableCollisionDetection:{type:Boolean,default:!1},collisionDetectionEvents:{type:Array,default:function(){return[]}},collisionDetectionHandler:{type:Function},collisionDetectionMessageClass:{type:String},emitValuesInComplexObject:{type:Boolean,default:!1},initialValues:{type:Object,default:function(){return{}}},showHorizontalBar:{type:Boolean}},data:function(){return{showCollisionDetection:null,schema:{},values:Object(n.cloneDeep)(this.initialValues),errors:{},serverErrors:{},clientValidators:Object(a.a)(),formId:this.getUuid(),testSchema:{HiddenFields:{HiddenField1:"hidden-field-1","HiddenGroup.Field2":"hidden-field-2"},Fields:[{Name:"",Type:"FormGroup",IsFormGroup:1,Config:{Fields:[{Name:"FormInput",Label:"Input field",Type:"FormInput",Placeholder:"This is a placeholder",Description:"This is an input field description.",Hint:"It even has a hint below.",Required:!0,Validators:["Required"]}]}},{Name:"",Type:"FormGroup",IsFormGroup:1,Config:{Fields:[{Name:"FormSelect",Label:"Select field",Type:"FormSelect",Placeholder:"Select...",Description:"This is a select field description.",Props:{Options:[{id:1,label:"Option 1"},{id:2,label:"Option 2"},{id:3,label:"Option 3"}]}}]}},{Name:"",Type:"FormGroup",IsFormGroup:1,Config:{Fields:[{Name:"FormTextArea",Label:"Text field",Type:"FormTextArea",Placeholder:"This is a placeholder",Description:"This is a text field description.",Required:!0,Validators:["Required"]}]}},{Name:"",Type:"FormGroup",IsFormGroup:1,Config:{Fields:[{Name:"FormCheckbox",Label:"Checkbox field",Type:"FormCheckbox",Description:"This is a checkbox field description."}]}},{Name:"",Type:"FormGroup",IsFormGroup:1,Config:{Fields:[{Name:"FormRadio",Label:"Radio field",Type:"FormRadio",Description:"This is a radio field description.",Props:{Options:[{id:1,label:"First choice"},{id:2,label:"Second choice"}]}}]}}]}}},computed:{localPropOverride:function(){return c({},this.propOverride,{formId:this.formId})},body:function(){return c({},this.params,{},this.values,{},this.hiddenValues,{FormID:this.formId})},hiddenValues:function(){return this.schema.HiddenFields?this.schema.HiddenFields:{}}},watch:{url:function(){this.getSchema()}},mounted:function(){this.getSchema({NoAutofocus:this.noAutofocus},this.$route.query)},methods:{removeValue:function(e,t){var i=this.values[t];if(this.$delete(this.values,t),this.$delete(this.errors,t),e.SubmitForm)return this.clientValidation(this.schema)&&this.submit(),void this.emitChanged(t,i,void 0);e.UpdateForm&&this.getSchema(),this.emitChanged(t,i,void 0)},setValue:function(e,t,i){var o=Object.hasOwnProperty.call(this.values,t),r=this.values[t];if(this.$set(this.values,t,i),o){var s=this.validateField(e,t,i);if(e.SubmitForm)return s&&this.clientValidation(this.schema)&&this.submit(),void this.emitChanged(t,r,i);e.UpdateForm&&this.getSchema({ChangedField:{Name:t,NewValue:i,OldValue:r}}),this.emitChanged(t,r,i)}},getSchema:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.testMode?this.processSchema(this.testSchema):this.clientSendRequest({Path:this.url,Method:"post",Query:i,Body:c({},this.body,{Meta:t})},{xhr:this.xhr}).then(function(t){e.processSchema(t.Body.Schema)}).catch(function(t){e.$log.error(t)})},processSchema:function(e){var t=this,i=e;this.values={},this.initValues({Name:"",Fields:i.Fields}),this.schema=i,i.Fields.length&&this.$nextTick(function(){t.$emit("ready",t.body)}),this.errors&&this.clientValidation(this.schema,null,!0),this.$nextTick(function(){t.$test.setFlag("Form::Update",t.url)})},initValues:function(e){var t=this,i=e.Name.length>0?"".concat(e.Name,"."):"";e.Fields.forEach(function(e){e.IsFormGroup?t.initValues({Name:i+e.Name,Fields:e.Config.Fields}):t.$set(t.values,"".concat(i).concat(e.Name),e.Value)})},validateForm:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(Object.keys(this.body).map(function(t){return void 0===e.body[t]&&(e.body[t]=null),e.body}),this.enableCollisionDetection&&this.$refs.collisionDetection.close(),this.testMode)return t?Promise.resolve(this.body):(this.$emit("valid",this.body),null);var i={};return this.schema.ChangeTime&&(i.ChangeTime=this.schema.ChangeTime),this.clientSendRequest({Path:this.url,Method:"post",Body:c({},this.body,{Meta:i}),Headers:{"X-OTRS-API-ValidateFormData":1}},{xhr:this.xhr}).then(function(){e.$set(e,"errors",{});var i=e.getValues(!0);return t?Promise.resolve(i):(e.$emit("valid",i),e.$nextTick(function(){e.$test.setFlag("Form::Valid",e.url)}),null)}).catch(function(i){var o=i.response;return o.Body.Errors&&(e.serverErrors=o.Body.Errors),o.Body.Schema&&(e.schema=o.Body.Schema,e.initValues({Name:"",Fields:e.schema.Fields})),422===o.Code&&e.showServerErrors(),e.enableCollisionDetection&&409===o.Code&&(e.schema.ChangeTime=o.Body.ChangeTime,e.$refs.collisionDetection.open()),t?Promise.reject(i):(e.$emit("invalid",i),e.$nextTick(function(){e.$test.setFlag("Form::Invalid",e.url)}),null)})},submit:function(){this.validateForm()},submitAsync:function(){return this.validateForm(!0)},showServerErrors:function(){var e=this;this.$set(this,"errors",{}),Object.keys(this.serverErrors).forEach(function(t){var i=Object(n.upperFirst)(Object(n.camelCase)(e.serverErrors[t].Validator)),o=e.clientValidators[i];if(o&&"function"==typeof o.errorMessage){var r=o.errorMessage(e.serverErrors[t].Attributes.Arguments);r&&e.$set(e.errors,t,r)}else e.serverErrors[t].Message&&e.$set(e.errors,t,[e.serverErrors[t].Message,e.serverErrors[t].Data])})},clientValidation:function(e,t,i){var o=this,r=!0;return e.Fields.forEach(function(e){var s;s=t?"".concat(t,".").concat(e.Name):e.Name,e.IsFormGroup?o.clientValidation(e.Config,s,i)||(r=!1):i?o.errors[s]&&(o.validateField(e,s,o.values[s])||(r=!1)):o.validateField(e,s,o.values[s])||(r=!1)}),r},validateField:function(e,t,i){var o=this;if(this.errors[t]&&this.$delete(this.errors,t),void 0===e.Validators)return!0;var r=!1;return e.Validators.forEach(function(s){if(!r&&(e.Required||null!==i&&void 0!==i&&""!==i)){var a=[],l=s;s instanceof Object&&(l=s.Validator,a=s.Arguments),l=Object(n.upperFirst)(Object(n.camelCase)(l));var c=o.clientValidators[l];if(c&&"function"==typeof c.validate&&!c.validate(i,a)&&(r=!0,"function"==typeof c.errorMessage)){var u=c.errorMessage(a);u&&o.$set(o.errors,t,u)}}}),!r},resetForm:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.$set(this,"schema",{}),this.$set(this,"values",{}),this.formId=this.getUuid(),t&&this.getSchema(),this.$nextTick(function(){e.$set(e,"errors",{})})},onSubmit:function(){this.clientValidation(this.schema)&&this.submit()},onReset:function(){this.resetForm()},onCollisionDetected:function(e){var t=this,i=function(i,o){if(t.collisionDetectionHandler){var r=t.collisionDetectionHandler(e);r&&r.then instanceof Function?r.then(function(e){return i(e)}).catch(function(e){return o(e)}):i(r)}else i({})};return new Promise(function(e,o){t.testMode?i(e,o):t.clientSendRequest({Path:t.url,Method:"post",Headers:{"X-OTRS-API-OnlyFormChangeTime":1}},{xhr:t.xhr}).then(function(r){t.schema.ChangeTime=r.Body.ChangeTime,i(e,o)}).catch(function(e){return t.$log.error(e),o(e)})})},closeCollisionDetectionMessage:function(){this.enableCollisionDetection&&this.$refs.collisionDetection.close()},onFiltered:function(e){this.$emit("filtered",e)},onLoaded:function(){var e=this;this.$nextTick(function(){e.$test.setFlag("Form::Loaded",e.url)})},buildValuesToEmit:function(){var e=c({},this.values,{},this.hiddenValues);if(!this.emitValuesInComplexObject)return e;var t={};return Object.keys(e).forEach(function(i){var o=e[i];if(i.match(/\./)){var r=t,s=i.split(".");s.forEach(function(e,t){if(t+1<s.length)return r[e]||(r[e]={}),void(r=r[e]);r[e]=o})}else t[i]=o}),t},getValues:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.buildValuesToEmit();return e&&(t=c({},this.params,{},t,{FormID:this.formId})),t},emitChanged:function(e,t,i){this.$emit("changed",this.body,{fullName:e,oldValue:t,newValue:i})}}},d=i("psIG"),h=Object(d.a)(u,function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.schema.Fields?i("b-form",{on:{reset:function(t){return t.preventDefault(),e.onReset(t)},submit:function(t){return t.preventDefault(),e.onSubmit(t)}}},[e.enableCollisionDetection?i("CommonCollisionDetectionMessage",{ref:"collisionDetection",class:e.collisionDetectionMessageClass,attrs:{events:e.collisionDetectionEvents,handler:e.onCollisionDetected,"test-mode":e.testMode},scopedSlots:e._u([{key:"default",fn:function(t){return[e._t("collision-detection-message",null,null,t)]}}],null,!0)}):e._e(),e._v(" "),e._t("before-form-fields"),e._v(" "),i("FormGroup",{attrs:{"set-value":e.setValue,"remove-value":e.removeValue,fields:e.schema.Fields,errors:e.errors,"prop-override":e.localPropOverride,"hide-description":e.hideDescription,"filter-text":e.filterText,"show-horizontal-bar":e.showHorizontalBar,"is-root":""},on:{loaded:e.onLoaded,filtered:function(t){return e.onFiltered(t)}},model:{value:e.values,callback:function(t){e.values=t},expression:"values"}}),e._v(" "),e._t("after-form-fields"),e._v(" "),e._t("submit-buttons")],2):e._e()},[],!1,null,null,null);t.default=h.exports}}]);