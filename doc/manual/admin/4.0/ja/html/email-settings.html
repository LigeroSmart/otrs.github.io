<html><head>
<!-- otrs.github.io -->
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../../documentation.css">
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="../../../../../documentation.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<script>
$(document).ready(function() {

    // Hint languages to prevent false matches (php for example).
    hljs.configure({
        languages: ['perl', 'javascript', 'xml', 'html', 'css', 'json', 'yaml', 'bash']
    });

    // programlistings in manuals
    $('pre.programlisting').each(function(i, block) {
        hljs.highlightBlock(block);
    });
    // code snippets in Perl API docs
    $('.pod pre').addClass('perl').each(function(i, block) {
        hljs.highlightBlock(block);
    });
});</script>
<!-- otrs.github.io -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Eメール設定</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="OTRS 4 - 管理 マニュアル"><link rel="up" href="administration.html" title="第4章 管理"><link rel="prev" href="backup-and-restore.html" title="システムのバックアップ"><link rel="next" href="external-backends.html" title="外部バックエンドの使用"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Eメール設定</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="backup-and-restore.html">戻る</a> </td><th width="60%" align="center">第4章 管理</th><td width="20%" align="right"> <a accesskey="n" href="external-backends.html">次へ</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="email-settings"></a>Eメール設定</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="email-settings.html#email">Eメールの送信/受信</a></span></dt><dd><dl><dt><span class="section"><a href="email-settings.html#email-sending">Eメールの送信</a></span></dt><dd><dl><dt><span class="section"><a href="email-settings.html#email-sending-sendmail">Sendmail(デフォルト)経由。</a></span></dt><dt><span class="section"><a href="email-settings.html#email-sending-smtp">SMTPサーバまたは smarthost経由。</a></span></dt></dl></dd><dt><span class="section"><a href="email-settings.html#email-receiving">Eメールの受信</a></span></dt><dd><dl><dt><span class="section"><a href="email-settings.html#email-receiving-pop3">OTRS GUI OTRSで構成されたEメールアカウント</a></span></dt><dt><span class="section"><a href="email-settings.html#email-receiving-cmd">コマンドライン・プログラムおよびprocmail経由(otrs.PostMaster.pl)</a></span></dt><dt><span class="section"><a href="email-settings.html#email-receiving-fetchmail">otrs.PostMaster.plのためのPOP3, IMAPおよびfetchmailによるEメールの取得</a></span></dt><dt><span class="section"><a href="email-settings.html#email-receiving-filter">OTRS/PostMasterモジュール(より多く複雑な送信用の)によるフィルター/送信</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="email-settings.html#configure-pgp">PGP鍵を備えた安全なEメール</a></span></dt><dt><span class="section"><a href="email-settings.html#smime">S/MIMEを備えた安全なEメール</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="email"></a>Eメールの送信/受信</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="email-sending"></a>Eメールの送信</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-sending-sendmail"></a>Sendmail(デフォルト)経由。</h5></div></div></div><p>
OTRSは、<a class="ulink" href="http://www.sendmail.org/" target="_top">Sendmail</a>、<a class="ulink" href="http://www.postfix.org/" target="_top">Postfix</a>、<a class="ulink" href="http://www.qmail.org" target="_top">Qmail</a>あるいは<a class="ulink" href="http://www.exim.org" target="_top">Exim</a>によってEメールを送信することができます。デフォルト構成はsendmailを使用し使用開始時に即稼働します。
</p><p>
グラフィカルな構成フロント・エンドによってsendmailの設定を構成することができます。(Framework::Core::Sendmail)
</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-sending-smtp"></a>SMTPサーバまたは smarthost経由。</h5></div></div></div><p>
OTRS can send emails via SMTP (<a class="ulink" href="http://www.ietf.org/rfc/rfc821.txt" target="_top">Simple Mail Transfer Protocol / RFC
821</a>) or Secure SMTP.
</p><p>
SMTPサーバー・セッティングは、SysConfig(Framework::Core::Sendmail)によって構成できます。オプションのSMTPSを利用可能として見つけることができないならば、必要なパール・モジュールがないということです。その場合は、<a class="link" href="manual-installation-of-otrs.html#installation-of-perl-modules" title="ステップ2：Perlモジュールの追加インストール">"OTRSに必要なパール・モジュールのインストレーション"</a>を参照してください。
</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="email-receiving"></a>Eメールの受信</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-pop3"></a>OTRS GUI OTRSで構成されたEメールアカウント</h5></div></div></div><p>
OTRSは、POP3、POP3S、IMAPおよびIMAPSメールアカウントからEメールを受け取ることができます。
</p><p>
管理者ページのPostMasterメールアカウント・リンク経由でメールアカウントを構成して下さい。
</p><p>
新規メールアカウントが作成されることになっている場合(下記の図を参照)そのメールサーバ名、ログイン名およびパスワードが指定されなければいけません。また、POP3,
POP3S, IMAP あるいは
IMAPS等のようなメールサーバタイプを選択する必要があります。サーバー・タイプのオプションとして利用可能なものが見あたらなければ、システムに必要なPerlモジュールがないことがその理由です。その場合、指示に関しては<a class="link" href="manual-installation-of-otrs.html#installation-of-perl-modules" title="ステップ2：Perlモジュールの追加インストール">
"OTRSに必要なパール・モジュールのインスタレーション"</a>を参照してください。</p><p>
</p><div class="screenshot"><div><img src="screenshots/add-mailaccount.png"></div></div><p>
</p><p>
<span class="emphasis"><em>図:メールアカウントの追加。</em></span>
</p><p>信頼済オプションの値にYesを選べば、受信メッセージに付けられたどんなX-OTRSヘッダーも評価され実行されます。X-OTRSヘッダーがチケットシステムの中のいくつかのアクションを実行することができるので既知の送信者だけに信頼済オプションをYesにセットするべきです。X-OTRSヘッダーはOTRSでは<a class="link" href="administration.html#adminarea-postmasterfilter" title="受信Eメール・メッセージのフィルタリング">フィルタ・モジュール</a>によって使用されます。X-OTRSヘッダーは、<a class="link" href="administration.html#table-of-x-otrs-headers" title="表4.5 異なるX-OTRSヘッダーの機能">このテーブルの中で</a>より詳細に説明されます。作成されたどんなpostmasterフィルタ規則も、信頼されたオプションのセッティングに関係なく実行されます。
</p><p>
The distribution of incoming messages can be controlled if they need to be
sorted by queue or by the content of the "To:" field. For the Dispatching
field, if "Dispatching by selected queue" is selected, all incoming messages
will be sorted into the specified queue. The address where the mail was sent
to is disregarded in this case. If "Dispatching by email To: field" is
selected, the system checks if a queue is linked with the address in the To:
field of the incoming mail. You can link an address to a queue in the <a class="link" href="administration.html#adminarea-emailaddresses" title="Eメール・アドレス">E-mail address management</a> section
of the Admin page. If the address in the To: field is linked with a queue,
the new message will be sorted into the linked queue. If no link is found
between the address in the To: field and any queue, then the message flows
into the "Raw" queue in the system, which is the <a class="link" href="ConfigReference_Ticket.html#ConfigReference_Ticket:Core::PostMaster:PostmasterDefaultQueue" title="PostmasterDefaultQueue">PostmasterDefaultQueue</a>
after a default installation.
</p><p>
メールアカウント用データはすべてOTRSデータベースの中で保存されます。<code class="filename">otrs.PostMasterMailbox.pl</code>
スクリプト(OTRSインストレーションの<code class="filename">bin</code>ディレクトリーにあります)は、データベースの中で設定を使用し、メールを取って来ます。全てのメール設定が適切に動いているかどうかをチェックするために<code class="filename">./bin/otrs.PostMasterMailbox.pl</code>を手動で実行することができます。
</p><p>
On a normal installation, the mail will be fetched every 10 minutes by the
<code class="filename">postmaster_mailbox</code> cron job. For further information
about modifying cron jobs, please refer to the <a class="link" href="manual-installation-of-otrs.html#installation-source-cronjobs" title="ステップ11：OTRSユーザーのcronジョブ">"Setting up the cron jobs for
OTRS"</a> section.
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p>
メールを取って来る場合、OTRSはPOPかIMAPサーバーからメールを削除します。さらにサーバ上でコピーを保存するオプションはありません。サーバのコピーを保持したければ、メールサーバで転送規則を作成するとよいでしょう。詳細のためにメールサーバ・ドキュメンテーションを調べてください。
</p></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-cmd"></a>コマンドライン・プログラムおよびprocmail経由(otrs.PostMaster.pl)</h5></div></div></div><p>
OTRSにEメールを入れるためにメールアカウントを使用することができなければ、コマンドライン・プログラム
<code class="filename">bin/otrs.PostMaster.pl</code>はその問題を解決するひとつの方法かもしれません。それはSTDIN経由でメールを取り、OTRSにそれらを直接送ります。それは、MDA(メール配信エージェント(例えばprocmail))がこのプログラムを実行すれば、EメールがOTRSシステムにおいて利用可能だろうということを意味します。
</p><p>
MDAなしで
<code class="filename">bin/otrs.PostMaster.pl</code>をテストするには、次のスクリプトのコマンドを実行してください。
</p><p>
</p><pre class="screen">
linux:/opt/otrs# cd bin
linux:/opt/otrs/bin# cat ../doc/sample_mails/test-email-1.box | ./otrs.PostMaster.pl
linux:/opt/otrs/bin#
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト:MDAのないポストマスターのテスト</em></span>
</p><p>
EメールがQueueViewの中で表示される場合、あなたの設定は正しく動作しています。
</p><p>
ProcmailはLinux環境中でとても普及しているEメール・フィルタです。ほとんどのシステムにそれがインストールされます。そうでなければ、<a class="ulink" href="http://www.procmail.org/" target="_top"><em class="citetitle">procmailホームページ</em></a>を見てください。
</p><p>
OTRS用にprocmailを構成するためには(sendmail、postfix、eximあるいはqmailといったprocmail構成のMTAに基づいた）、<code class="filename">~otrs/.procmailrc.dist</code>ファイルを使用して、<code class="filename">.procmailrc</code>にそれをコピーして、スクリプトのラインを下に加えてください。
</p><p>
</p><pre class="programlisting">
SYS_HOME=$HOME
PATH=/bin:/usr/bin:/usr/local/bin
# --
# 全てのEメールをthe PostMaster processへPipe します。
# --
:0 :
| $SYS_HOME/bin/otrs.PostMaster.pl
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト:OTRSのためのprocmailの構成。</em></span>
</p><p>
localのOTRSユーザへ送られたEメールはすべて、<code class="filename">bin/otrs.PostMaster.pl</code>に送られ、QueueViewで表示されるでしょう。
</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-fetchmail"></a>otrs.PostMaster.plのためのPOP3, IMAPおよびfetchmailによるEメールの取得</h5></div></div></div><p>
メールサーバから、POP3またはIMAPのメールボックス経由で、OTRSマシン/ローカルのOTRSアカウント、およびprocmailにEメールを受け取るために、<a class="ulink" href="http://fetchmail.berlios.de/" target="_top">fetchmail</a>を使用します。
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p>
OTRSマシン上で作動してるSMTP構成が必要です。
</p></div><p>
OTRSのホームディレクトリーの中で<code class="filename">.fetchmailrc.dist</code>を使用し、必要に応じて<code class="filename">.fetchmailrc</code>.Modfiy/changeにそれをコピーすることができます。(下記の例7-1を参照)
</p><div class="example"><a name="fetchmailrc"></a><p class="title"><b>例4.2 .fetchmailrc</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
#poll (mailserver) protocol POP3 user (user) password (password) is(localuser)
poll mail.example.com protocol POP3 user joe password mama is otrs
</pre><p>
</p></div></div><br class="example-break"><p>
.fetchmailrcを710("chmod 710.fetchmailrc")にセットすることを忘れないでください!
</p><p>
上記の例7-1からの<code class="filename">.fetchmailrc</code>で、コマンド<span class="command"><strong>fetchmail
-a</strong></span>が実行されれば、EメールはすべてローカルのOTRSアカウントへ転送されるでしょう。メールを規則的に取って来たい場合は、このコマンドでcronjobをセット・アップしてください。
</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-filter"></a>OTRS/PostMasterモジュール(より多く複雑な送信用の)によるフィルター/送信</h5></div></div></div><p>
bin/otrs.PostMaster.plあるいはbin/otrs.PostMasterMailbox.plの方法を使用すれば、PostMasterフィルタ・モジュールを備えたX-OTRSヘッダー・エントリを挿入するか修正することができます。チケットシステムは、X-OTRSヘッダーによって、受信に対するいくつかのアクションを実行するか、特定のキューへそれらをソートするか、優先度を変更するか、あるいは例えば顧客IDを変更することができます。X-OTRSヘッダーに関してより多くの情報、OTRS管理者ページからの<a class="link" href="administration.html#adminarea-postmasterpop3-account" title="Eメールアカウントの使用">「メールアカウントの追加」</a>に関するセクションにおいて利用可能です。
</p><p>
いくつかのデフォルト・フィルタ・モジュールがあります:
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p>
ジョブ名 (e.g. $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'JobName'})
はユニークである必要があります。
</p></div><p>
ernel::System::PostMaster::Filter::Match　は、いくつかのEメールヘッダ(e.g. From, To,
Subject, ...)をマッチさせるためのデフォルトモジュールです。　フィルタ規則がマッチすれば、それは新規Eメールヘッダ(例：
X-OTRS-Ignore: yes or X-OTRSQueue:spam)にセットできます。例　7-2のジョブは
<code class="filename">Kernel/Config.pm</code> に挿入可能です。
</p><div class="example"><a name="filter-module-match-example"></a><p class="title"><b>例4.3 フィルタ・モジュールのためのサンプルジョブ</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
    # Job Name: 1-Match
    # (noreply@からの全てのスパムEメールをブロックまたは無視)
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'1-Match'} = {
        Module =&gt; 'Kernel::System::PostMaster::Filter::Match',
        Match =&gt; {
            From =&gt; 'noreply@',
        },
        Set =&gt; {
            'X-OTRS-Ignore' =&gt; 'yes',
        },
    };
    # Job Name: 2-Match
    # (件名: **ORDER**かつsales@example.comからのEメールをソート)
    # into queue 'Order')
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'2-Match'} = {
        Module =&gt; 'Kernel::System::PostMaster::Filter::Match',
        Match =&gt; {
            To =&gt; 'sales@example.com',
            Subject =&gt; '**ORDER**',
        },
        Set =&gt; {
            'X-OTRS-Queue' =&gt; 'Order',
        },
    };
</pre><p>
</p></div></div><br class="example-break"><p>
Kernel::System::PostMaster::Filter::CMDは外部コマンドにEメールを送る、デフォルト・モジュールです。出力はSTDOUTに与えられます、また、結果がTrueの場合、新規Eメール・ヘッダー(例えば、X-OTRS-Ignore:
yes or X-OTRS-Queue:
spam）をセットします。例7-3は　<code class="filename">Kernel/Config.pm</code>で使用することができます。
</p><div class="example"><a name="filter-module-cmd-example"></a><p class="title"><b>例4.4 フィルタ・モジュールのためのサンプル・ジョブ　Kernel::System::PostMaster::Filter::CMD</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
    # Job Name: 5-SpamAssassin
    # (SpamAssassin サンプルセットアップ, スパムメールを無視します)
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'5-SpamAssassin'} = {
        Module =&gt; 'Kernel::System::PostMaster::Filter::CMD',
        CMD =&gt; '/usr/bin/spamassassin | grep -i "X-Spam-Status: yes"',
        Set =&gt; {
            'X-OTRS-Ignore' =&gt; 'yes',
        },
    };
</pre><p>
</p></div></div><br class="example-break"><p>
    Kernel::System::PostMaster::Filter::ExternalTicketNumberRecognitionは、Eメールの件名、本文、または正規表現を使用する両方に、外部識別子を解析する可能性を加えるデフォルト・モジュールです。その後、それは定義された動的フィールドにこの値を格納します。Eメールが中へ入る時、OTRSは最初に外部識別子を検索し、1つ見つけると、あらかじめ定義された動的フィールドについてOTRSにクエリします。それは既存のチケットを見つければ、このチケットを更新するでしょう。そうでなければ、それは別々のフィールドに外部参照番号で新規チケットを作成するでしょう。
</p><p>
    OTRS
SysConfigは、異なる外部チケット番号を設定するために４つの異なる設定を既に供給していますより多くのセッティングが必要な場合、それらを手動で加える必要がある必要があります。次の例はSysConfig設定を拡張するために<code class="filename">Kernel/Config.pm</code>の中で使用することができます。
</p><div class="example"><a name="filter-module-externalticketrecognition-example"></a><p class="title"><b>例4.5 
        フィルター・モジュールのためのサンプル・ジョブKernel::System::PostMaster::Filter::ExternalTicketNumberRecognition
    </b></p><div class="example-contents"><pre class="programlisting">
    # Job Name: ExternalNumber
# 外部チケット番号の認識では、&lt;送信者&gt;@externalticket.comのアドレス
# からの入信Eメールの中の件名と本文インシデント&lt;番号&gt;をチェックします。
# &lt;番号&gt;が見つかればそれは動的フィールド「ExternalNumber(外部番号)」
# に保存されます。（管理者バネルで設定が必要）
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'000-ExternalTicketNumberRecognition5'} =  {
        'FromAddressRegExp' =&gt; '\\s*@externalticket.com',
        'NumberRegExp'      =&gt; 'Incident-(\\d.*)',
        'SearchInSubject'   =&gt; '1',
        'SearchInBody'      =&gt; '1',
        'TicketStateTypes'  =&gt; 'new;open'
        'DynamicFieldName'  =&gt; 'ExternalNumber',
        'Module'            =&gt; 'Kernel::System::PostMaster::Filter::ExternalTicketNumberRecognition',
        'Name'              =&gt; 'Test External Ticket Number',
        'SenderType'        =&gt; 'system',
    };
    </pre></div></div><br class="example-break"><div class="itemizedlist"><p><span class="emphasis"><em>構成オプション</em></span></p><ul class="itemizedlist" type="round"><li class="listitem"><p>FromAddressRegExp</p><p>
            これはオプションの設定です。この「From:」アドレスと一致しているメールだけがこのフィルターで考慮されます。この設定を調整して、送信メール用外部システム利用を、送信者アドレスにすることができます。このアドレスが異なる場合、このオプションを空にすることができます。この場合、OTRSは送信者アドレスをチェックしません。
        </p></li><li class="listitem"><p>NumberRegExp</p><p>
            これは必須設定項目です。この設定は　件名またはチケットの本文からチケット番号を抽出するためにOTRSが使う正規表現を含みます。デフォルトの正規表現は　以下のような例の発生と一致するでしょう。例えば「Incident-12354」そしてその部分を動的フィールド中に括弧で挟む部分を置きます（ここでは「12354」）
        </p></li><li class="listitem"><p>SearchInSubject</p><p>これが「1」にセットされる場合、Eメール件名はチケット番号を求めて検索されます。</p></li><li class="listitem"><p>SearchInBody</p><p>これが「1」にセットされる場合、Eメール本文はチケット番号を求めて検索されます。</p></li><li class="listitem"><p>TicketStateTypes（チケット・状態・タイプ）</p><p>
            これはオプションの設定です。もし与えられれば、それは与えられた状態タイプの開いた外部チケットのみOTRSを検索するでしょう。状態タイプはセミコロンで分離されます。
        </p></li><li class="listitem"><p>DynamicField</p><p>
            これは必須の設定で、外部番号を保存するために使われている動的フィールドを定義します。(フィールド名はシステムに存在しなければいけないしかつ有効でなければなりません)
        </p></li><li class="listitem"><p>SenderType</p><p>これは、OTRSで記事作成に使用される送信者タイプを定義します。</p></li></ul></div><p>
もちろん、自分のPostMasterフィルタ・モジュールを開発することも可能です。
</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configure-pgp"></a>PGP鍵を備えた安全なEメール</h3></div></div></div><p>
OTRSは、PGP鍵を備えた送信メッセージに署名するか暗号化する能力を持っています。更に、暗号化された受信メッセージは解読することができます。暗号化と解読はGPLツールGnuPGで実施されます。OTRSのためのセットアップGnuPGに、次のステップを行なわなければなりません。
</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
    オペレーティング・システムのパッケージ・マネージャーによるGnuPGのインストール
    </p></li><li class="listitem"><p>
    OTRSで使うGnuPGを構成してください。GnuPGと秘密鍵のための必要なディレクトリを作成しなければなりません。シェルからユーザ「otrs」としてスクリプト中で下に示されるコマンドを実行しなければなりません。
    </p><p>
    </p><pre class="screen">
    linux:~# su otrs
    linux:/root$ cd
    linux:~$ pwd
    /opt/otrs
    linux:~$ gpg --gen-key
    gpg (GnuPG) 1.4.2; Copyright (C) 2005 Free Software Foundation, Inc.
    This program comes with ABSOLUTELY NO WARRANTY.
    This is free software, and you are welcome to redistribute it
    under certain conditions. See the file COPYING for details.

    gpg: directory `/opt/otrs/.gnupg' created
    gpg: new configuration file `/opt/otrs/.gnupg/gpg.conf' created
    gpg: WARNING: options in `/opt/otrs/.gnupg/gpg.conf' are not yet active during t
    his run
    gpg: keyring `/opt/otrs/.gnupg/secring.gpg' created
    gpg: keyring `/opt/otrs/.gnupg/pubring.gpg' created
    Please select what kind of key you want:
       (1) DSA and Elgamal (default)
       (2) DSA (sign only)
       (5) RSA (sign only)
    Your selection? 1
    DSA keypair will have 1024 bits.
    ELG-E keys may be between 1024 and 4096 bits long.
    What keysize do you want? (2048)
    Requested keysize is 2048 bits
    Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
    Key is valid for? (0)
    Key does not expire at all
    Is this correct? (y/N) y

    You need a user ID to identify your key; the software constructs the user ID
    from the Real Name, Comment and Email Address in this form:
        "Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;"

    Real name: Ticket System
    Email address: support@example.com
    Comment: Private PGP Key for the ticket system with address support@example.com
    You selected this USER-ID:
    "Ticket System (Private PGP Key for the ticket system with address support@examp
    le.com) &lt;support@example.com&gt;"

    Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O
    You need a Passphrase to protect your secret key.

    Passphrase: secret
    Repeat passphrase: secret

    We need to generate a lot of random bytes. It is a good idea to perform
    some other action (type on the keyboard, move the mouse, utilize the
    disks) during the prime generation; this gives the random number
    generator a better chance to gain enough entropy.
    ++++++++++.+++++++++++++++++++++++++....+++++.+++++...+++++++++++++++++++++++++.
    +++++++++++++++++++++++++.+++++.+++++.+++++++++++++++++++++++++&gt;++++++++++&gt;+++++
    .......&gt;+++++&lt;+++++................................+++++

    Not enough random bytes available.  Please do some other work to give
    the OS a chance to collect more entropy! (Need 280 more bytes)

    ++++++++++.+++++..++++++++++..+++++....++++++++++++++++++++.+++++++++++++++.++++
    ++++++++++++++++++++++++++.++++++++++.+++++++++++++++.++++++++++.+++++++++++++++
    ..+++++&gt;.+++++....&gt;+++++........................................................
    ...........................................................&gt;+++++&lt;+++++.........
    .............+++++^^^
    gpg: /opt/otrs/.gnupg/trustdb.gpg: trustdb created
    gpg: key 7245A970 marked as ultimately trusted
    public and secret key created and signed.

    gpg: checking the trustdb
    gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
    gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
    pub   1024D/7245A970 2006-02-03
          Key fingerprint = 2ED5 BC36 D2B6 B055 7EE1  5833 1D7B F967 7245 A970
     uid                  Ticket System (Private pgp key for ticket system with addre
    ss support@example.com) &lt;support@example.com&gt;
    sub   2048g/52B97069 2006-02-03

    linux:~$
    </pre><p>
    </p><p>
    <span class="emphasis"><em>スクリプト: GnuPGの構成</em></span>
    </p><p>
        スクリプトの中で下に示されるように、デフォルト構成は、ほとんどの要求されるパラメタのために適用することができます。キーに指定された適切なパスワードで、key所有者に対する値だけを正確に入力しなければなりません。
    </p></li><li class="listitem"><p>
    <a class="link" href="ConfigReference_Framework.html#ConfigReference_Framework:Crypt::PGP" title="Crypt::PGP">PGP</a>
の設定画面では、PGPはOTRSで有効になっており(一つ目のオプション)、また、PGPプログラムへのパスが設定され、有効になっている必要があります
    </p><p>
    次の構成設定(PGP::Options)はさらに変わることを要求するかもしれません。このコンフィグ・セッティングによって、「otrs」ユーザによってgpgのすべての実行に使用されるパラメタは指定することができます。特に「otrs」ユーザのGnuPGのための構成ファイルのディレクトリは重要です。例<code class="filename">/opt/otrs/.gnupg</code>の中で、使用されます。このディレクトリは、PGP鍵構成以前に作成されました。
    </p><p>
        次の構成オプション(PGP::Key::Password)によって、キーIDのペアおよび自身の秘密鍵のパスワードを指定することは可能です、なぜなら、外部からのコミュニケーションパートナーチケットシステムに彼らのメッセージを暗号化と秘密鍵で書き込み、OTRSはそれらのメッセージをIDとパスワードをここで指定して解読するからです。
    </p><p>
    どのようにしてあなた自身の秘密鍵のIDを得ることができますか？あなた自身の秘密鍵のIDはすでにキー生成時に表示されています。（上記ステップ１をご覧ください）さらに、次のスクリプト中で指定されたコマンドがユーザ「otrs」として実行される場合、IDを得ることが可能です:
    </p><p>
    </p><pre class="screen">
    linux:~# su otrs
    linux:/root$ cd
    linux:~$ pwd
    /opt/otrs
    linux:~$ gpg --list-keys
    /opt/otrs/.gnupg/pubring.gpg
    ----------------------------
    pub   1024D/7245A970 2006-02-03
    uid                  Ticket System (Private pgp key for ticket system with
    address support@example.com) &lt;support@example.com&gt;
    sub   2048g/52B97069 2006-02-03

    linux:~$
    </pre><p>
    </p><p>
    <span class="emphasis"><em>スクリプト:自分の秘密鍵のIDを得ること。</em></span>
    </p><p>
    秘密鍵のIDは、「サブ」で始まるラインで見つけることができます。それは長さ8文字で16進法の文字列で上の例では「52B97069」です。チケットシステムでこのキー用に指定しなければならないパスワードは、キー生成中に与えられたのと同じです。
    </p><p>
    このデータが挿入された後、「アップデート」ボタンはセッティングを保存するために使用することができます。これでOTRSは暗号化されたメッセージを受け取り解読する準備ができています。
    </p></li><li class="listitem"><p>
    このデータが挿入された後、「アップデート」ボタンはセッティングを保存するために使用することができます。これでOTRSは暗号化されたメッセージを受け取り解読する準備ができています。
    </p><p>
    最初の方法は、顧客管理インターフェースで顧客の公開鍵を指定することです。
    </p><p>
    第2の方法は、PGP鍵設定(管理者ページから到達可能)によってキーを指定することです。この画面の右側のセクションにおいては、すでにインポート済の顧客の公開鍵が全て表示されます。PGP鍵がOTRSのために活性化され構成されたら、自分の公開鍵もそこにリストされるべきです。PGP鍵設定画面の左のエリアでキーを探せます。さらに、新規公開鍵はファイルからシステムへアップロードすることができます。
    </p><p>
    OTRSへインポートされる必要のある公開鍵を備えたファイルはGnuPGP互換性をもつキー・ファイルでなければなりません。ほとんどの場合、ファイルに格納されたキーは「ASCII
armored key」です。OTRSはこのフォーマットを取り扱えます。
    </p></li></ol></div><p>
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="smime"></a>S/MIMEを備えた安全なEメール</h3></div></div></div><p>
一見、S/MIMEを備えた暗号化はPGP鍵を備えた暗号化より少し複雑に見えます。最初に、OTRSシステムのために認証局(CA)を設立しなければなりません。後のステップは、PGP鍵で必要とされるものに非常に似ています:OTRSの構成、自身の証明書のインストール、必要な他の証明書のインポート等。
</p><p>
S/MIME構成は、大部分はOTRSウェブインターフェースの外部で行われ、「otrs」ユーザによってシェルの中で実行されるべきです。Linux下のMIME構成SSL(OpenSSL)に基づきます。したがって、あなたのシステムにOpenSSLパッケージがインストールされるかどうかを第一にチェックしてください。OpenSSLパッケージは、CA.pl(証明書生成の最も重要なステップはそれで行なうことができます)と呼ばれるスクリプトを含んでいます。手続きを単純化するために、ファイルシステムでCA.plスクリプトが保存され、シェルのパス変数に一時的に位置を入力する場所を見つけます。(下記のスクリプトを参照)
</p><p>
</p><pre class="screen">
otrs@linux:~&gt; rpm -ql openssl | grep CA
/usr/share/ssl/misc/CA.pl
otrs@linux:~&gt; export PATH=$PATH:/usr/share/ssl/misc
otrs@linux:~&gt; which CA.pl
/usr/share/ssl/misc/CA.pl
otrs@linux:~&gt; mkdir tmp; cd tmp
otrs@linux:~/tmp&gt;
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト:S/MIMEの構成</em></span>
</p><p>
上記のスクリプトは、新規一時ディレクトリ~/tmpが作成されたことを表示しています。証明書はその中で生成されることになっています。
</p><p>
証明書を作成するためには、コマンドライン中から次のオペレーションを行なってください:(我々は、OTRS管理者がテスト用のSSL証明書および学習する目的を作成しなければならないと考えます。暗号化用の保証されたSSL証明書を既に持った場合それを使用して、これらのステップをスキップしてください。)
</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
    SSLのために自分の認証局を開設してください。自分のSSL証明書の要請を証明するためにそれを必要とする(下記のスクリプトを参照)。
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -newca
CA certificate filename (or enter to create)

Making CA certificate ...
Generating a 1024 bit RSA private key
...++++++
......++++++
writing new private key to './demoCA/private/cakey.pem'
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:DE
State or Province Name (full name) [Some-State]:OTRS-state
Locality Name (eg, city) []:OTRS-town
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Your company
Organizational Unit Name (eg, section) []:
Common Name (eg, YOUR name) []:OTRS Admin
Email Address []:otrs@your-domain.tld
otrs@linux:~/tmp&gt; ls -la demoCA/
total 8
-rw-r--r--  1 otrs otrs 1330 2006-01-08 17:54 cacert.pem
drwxr-xr-x  2 otrs otrs   48 2006-01-08 17:53 certs
drwxr-xr-x  2 otrs otrs   48 2006-01-08 17:53 crl
-rw-r--r--  1 otrs otrs    0 2006-01-08 17:53 index.txt
drwxr-xr-x  2 otrs otrs   48 2006-01-08 17:53 newcerts
drwxr-xr-x  2 otrs otrs   80 2006-01-08 17:54 private
-rw-r--r--  1 otrs otrs   17 2006-01-08 17:54 serial
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>スクリプト:　SSLのために認証局を設立</em></span>
    </p></li><li class="listitem"><p>
    証明書リクエストを生成してください(下記のスクリプトを参照)
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -newreq
Generating a 1024 bit RSA private key
..........................................++++++
....++++++
writing new private key to 'newreq.pem'
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:DE\keyreturn
State or Province Name (full name) [Some-State]:OTRS-state
Locality Name (eg, city) []:OTRS-town
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Your company
Organizational Unit Name (eg, section) []:
Common Name (eg, YOUR name) []:OTRS admin
Email Address []:otrs@your-domain.tld

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
Request (and private key) is in newreq.pem
otrs@linux:~/tmp&gt; ls -la
total 4
drwxr-xr-x  6 otrs otrs  232 2006-01-08 17:54 demoCA
-rw-r--r--  1 otrs otrs 1708 2006-01-08 18:04 newreq.pem
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>スクリプト:　証明書リクエストの作成</em></span>
    </p></li><li class="listitem"><p>
    証明書リクエストは署名され、それによってあなた自身のCAに証明されます。あるいは別の外部の保証されたCAによって署名されることによりさらに信頼性を高められます。（下記スクリプト参照）
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -signreq
Using configuration from /etc/ssl/openssl.cnf
Enter pass phrase for ./demoCA/private/cakey.pem:
Check that the request matches the signature
Signature ok
Certificate Details:
        Serial Number:
            fd:85:f6:9f:14:07:16:c8
        Validity
            Not Before: Jan  8 17:04:37 2006 GMT
            Not After : Jan  8 17:04:37 2007 GMT
        Subject:
            countryName               = DE
            stateOrProvinceName       = OTRS-state
            localityName              = OTRS-town
            organizationName          = Your Company
            commonName                = OTRS administrator
            emailAddress              = otrs@your-domain.tld
        X509v3 extensions:
            X509v3 Basic Constraints:
                CA:FALSE
            Netscape Comment:
                OpenSSL Generated Certificate
            X509v3 Subject Key Identifier:
                01:D9:1E:58:C0:6D:BF:27:ED:37:34:14:D6:04:AC:C4:64:98:7A:22
            X509v3 Authority Key Identifier:
                keyid:10:4D:8D:4C:93:FD:2C:AA:9A:B3:26:80:6B:F5:D5:31:E2:8E:DB:A8
                DirName:/C=DE/ST=OTRS-state/L=OTRS-town/O=Your Company/
                CN=OTRS admin/emailAddress=otrs@your-domain.tld
                serial:FD:85:F6:9F:14:07:16:C7

Certificate is to be certified until Jan  8 17:04:37 2007 GMT (365 days)
Sign the certificate? [y/n]:y

1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated
Signed certificate is in newcert.pem
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>スクリプト:証明書リクエストの署名</em></span>
    </p></li><li class="listitem"><p>
    あなた自身の証明書を生成して下さい。そしてそれに伴い、署名された証明書を使う、すべてのデータを生成して下さい。（下記スクリプト参照）
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -pkcs12 "OTRS Certificate"
Enter pass phrase for newreq.pem:
Enter Export Password:
Verifying - Enter Export Password:
otrs@linux:~/tmp&gt; ls -la
total 12
drwxr-xr-x  6 otrs otrs  328 2006-01-08 18:04 demoCA
-rw-r--r--  1 otrs otrs 3090 2006-01-08 18:13 newcert.p12
-rw-r--r--  1 otrs otrs 3791 2006-01-08 18:04 newcert.pem
-rw-r--r--  1 otrs otrs 1708 2006-01-08 18:04 newreq.pem
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>スクリプト:新規証明書の生成</em></span>
    </p></li></ol></div><p>
</p><p>
今、これらのオペレーションが実行され、S/MIMEセットアップはOTRSの中で完成したはずです。
</p><p>
セットアップのこの部分はリンク<a class="link" href="administration.html#adminarea-smime" title="SMIME">"SMIME"</a>を選んで、管理者ページで実行されます。OTRSで一般的なS/MIMEサポートがまだ可能にされてない場合、マスク(mask)は管理者にこれを指摘し、それを可能にするために適切なリンクを提供します。
</p><p>
SysConfig group で<a class="link" href="ConfigReference_Framework.html#ConfigReference_Framework:Crypt::SMIME" title="Crypt::SMIME">"Crypt::SMIME"</a>
S/MIME に関する全般の設定が行えます
</p><p>
ここで、S/MIME支援を活性化し、OpenSSLコマンド用のパスおよび証明書用のディレクトリーを定義することができます。上に作成されたキー・ファイルは、ここで示されたディレクトリーに格納されなければいけません。そうでなければ、OpenSSLは使用できません。
</p><p>
次のステップは<a class="link" href="administration.html#adminarea-smime" title="SMIME">OTRS管理ページ上のS/MIME構成</a>で行われます。ここで、OTRSシステムの秘密鍵および他のコミュニケーション・パートナーの公開鍵(複数)をインポートすることができます。このセクションの最初に作成し、OTRSに追加した公開鍵を入力してください。
</p><p>
言うまでもなく、コミュニケーション・パートナーの全てのパブリックS/MIMEキーは<a class="link" href="administration.html#adminarea-customers" title="顧客">顧客管理ツール</a>を使用してインポートすることもできます。
</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="backup-and-restore.html">戻る</a> </td><td width="20%" align="center"><a accesskey="u" href="administration.html">上に戻る</a></td><td width="40%" align="right"> <a accesskey="n" href="external-backends.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">システムのバックアップ </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 外部バックエンドの使用</td></tr></table></div></body></html>
