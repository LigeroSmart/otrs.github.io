<html><head>
<!-- otrs.github.io -->
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../../documentation.css">
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="../../../../../documentation.js"></script>
<!-- otrs.github.io -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>OTRS на Windows</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="OTRS v.4 - Руководство Администратора"><link rel="up" href="installation.html" title="Глава 2. Установка"><link rel="prev" href="web-installer.html" title="Использование веб установщика"><link rel="next" href="upgrading.html" title="Обновление с 3.3 до 4"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">OTRS на Windows</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="web-installer.html">Пред.</a> </td><th width="60%" align="center">Глава 2. Установка</th><td width="20%" align="right"> <a accesskey="n" href="upgrading.html">След.</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="installation-on-windows"></a>OTRS на Windows</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="installation-on-windows.html#migrating-otrs-from-windows-into-appliance">Как перенести существующую систему на Windows в appliance/помощник</a></span></dt><dd><dl><dt><span class="section"><a href="installation-on-windows.html#introduction-and-preparation">Введение и подготовка</a></span></dt><dt><span class="section"><a href="installation-on-windows.html#get-otrsclonedb-script-to-clone-databases">Загрузите скрипт OTRSCloneDB для клонирования базы данных</a></span></dt><dt><span class="section"><a href="installation-on-windows.html#enable-remote-access-for-appliance-database">Включите удаленный доступ к базам postgresql вашей appliance</a></span></dt><dt><span class="section"><a href="installation-on-windows.html#backup-appliance-manangement-package">Резервное копирование OTRSApplianceManagement</a></span></dt><dt><span class="section"><a href="installation-on-windows.html#stop-all-otrs-services">Остановите сервисы OTRS</a></span></dt><dt><span class="section"><a href="installation-on-windows.html#id-1.4.6.3.7">Сделайте "drop" существующей БД вашего appliance, чтобы иметь пустую базу
для клонирования данных</a></span></dt><dt><span class="section"><a href="installation-on-windows.html#get-password-of-otrs-database">Получить пароль postgresql вашей БД</a></span></dt><dt><span class="section"><a href="installation-on-windows.html#clone-database-to-remote-appliance">Скопируйте вашу БД на удаленный appliance</a></span></dt><dt><span class="section"><a href="installation-on-windows.html#copy-otrs-base-files-to-remote-appliance">Скопируйте следующие файлы из вашей windows системы в appliance</a></span></dt><dt><span class="section"><a href="installation-on-windows.html#reinstall-packages-install-otrs-appliance-management">Переустановите все пакеты и установите OTRSApplianceManagement</a></span></dt><dt><span class="section"><a href="installation-on-windows.html#disable-remote-access-for-appliance-database">Выключите удаленный доступ к базам postgresql вашей appliance</a></span></dt><dt><span class="section"><a href="installation-on-windows.html#start-all-otrs-services">Запуск сервисов OTRS </a></span></dt></dl></dd></dl></div><p>
        Для запуска OTRS на Windows мы настоятельно рекомендуем использовать <a class="ulink" href="http://otrs.github.io/doc/manual/appliance/stable/en/html/index.html" target="_top">OTRS
Appliance</a>.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="migrating-otrs-from-windows-into-appliance"></a>Как перенести существующую систему на Windows в appliance/помощник</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="introduction-and-preparation"></a>Введение и подготовка</h4></div></div></div><p>
                Если у вас уже имеется установленная на Windows система и вы желаете
заменить ее на установку с appliance, то это руководство поможет вам
выполнить эту задачу.
            </p><p>
                В первую очередь необходимо обновить OTRS до последней версии 3.3.х во
избежание проблем при переносе.
            </p><p>
                После обновления вашей OTRS, необходимо выполнить отдельную установку с OTRS
appliance с той же версией, что и установка под Windows. Т. е., если вы
используете OTRS 3.3.x, то надо установить соответствующий OTRS Appliance
3.3.x. Здесь вы найдете подробное руководство по установке:
            </p><p>
                <a class="ulink" href="http://otrs.github.io/doc/manual/appliance/3.3/en/html/" target="_top">
<em class="citetitle">Руководство по установке Appliance</em> </a>
            </p><p>
                Список доступных для загрузки вариантов Аppliance можно найти здесь:
            </p><p>
                <a class="ulink" href="http://ftp.otrs.org/pub/otrs/" target="_top">
<em class="citetitle">http://ftp.otrs.org/pub/otrs/</em> </a>
            </p><p>
                В нашем примере нам нужен appliance для OTRS 3.3.10:
            </p><p>
                <a class="ulink" href="http://ftp.otrs.org/pub/otrs/otrs-3.3.10-appliance-1.0.10.iso" target="_top">
<em class="citetitle">http://ftp.otrs.org/pub/otrs/otrs-3.3.10-appliance-1.0.10.iso</em>
</a>
            </p><p>
                Теперь у нас есть 2 операционных системы и нам нужно перенести данные между
ними:
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="get-otrsclonedb-script-to-clone-databases"></a>Загрузите скрипт OTRSCloneDB для клонирования базы данных</h4></div></div></div><p>
                Перейдите в меню администратора системы на Windows и установите новейшую
версию OTRSCloneDB в OTRS:
            </p><p>
                Вы можете установить пакет OTRSCloneDB непосредственно с помощью менеджера
пакетов. Выберите "OTRS Extensions/Дополнения OTRS" из выпадающего списка
слева и кликните по кнопке "Обновить информацию репозитария" ниже. Когда с
строка с OTRSCloneDB будет отражена в списке, выберите ее и нажмите
"Установить".
            </p><p>
                Можно, также, загрузить пакет вручную с OTRS FTP сервера и установить его
вручную, как описано ниже. <a class="ulink" href="http://ftp.otrs.org/pub/otrs/packages/" target="_top">
<em class="citetitle">http://ftp.otrs.org/pub/otrs/packages/</em> </a>
            </p><p>
                Загрузите пакет с наибольшим номером версии:
            </p><p>
                </p><pre class="screen">
OTRSCloneDB-1.0.10.opm
                </pre><p>
            </p><p>
                </p><div class="screenshot"><div><img src="screenshots/win-download-otrsclonedb.png"></div></div><p>
            </p><p>
                и установите его в вашу систему на Windows:
            </p><p>
                </p><div class="screenshot"><div><img src="screenshots/win-install-otrsclonedb.png"></div></div><p>
            </p><p>
                Если у вас были установлены какие-то расширения OTRS/feature addons или
собственные разработки, проблем быть не должно. Надо только убедиться, что
все из ваших установленных пакетов также имеют совместимость с системами на
unix. С пакетами, предоставляемыми OTRS дело обстоит именно так.
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="enable-remote-access-for-appliance-database"></a>Включите удаленный доступ к базам postgresql вашей appliance</h4></div></div></div><p>
                Скрипт OTSRCloneDB будет копировать базы данных удаленно и для этого должен
быть включен удаленный доступ к postgresql database.
            </p><p>
                Подключитесь к вашему appliance через SSH, это можно сделать с помощью
бесплатного инструмента типа "PuTTY" (просто поищите в интернета по фразе
"putty ssh"). IP-адрес appliance отображается на его экране. После
подключения нужно выполнить изменения в каталоге postgresql:
            </p><p>
                </p><pre class="screen">
shell&gt; cd /etc/postgresql/8.4/main
shell&gt; vi postgresql.conf
                </pre><p>
            </p><p>
                Добавьте следующую строку в конец файла:
            </p><p>
                </p><pre class="screen">
listen_addresses = '*'
                </pre><p>
            </p><p>
                Сохраните файл.
            </p><p>
                </p><pre class="screen">
shell&gt; vi pg_hba.conf
                </pre><p>
            </p><p>
                Добавьте следующую строку в конец файла:
            </p><p>
                </p><pre class="screen">
host all all  0.0.0.0/0 md5
                </pre><p>
            </p><p>
                Сохраните файл.
            </p><p>
                Перезапустите сервер postgresql
            </p><p>
                </p><pre class="screen">
shell&gt; service postgresql restart
                </pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="backup-appliance-manangement-package"></a>Резервное копирование OTRSApplianceManagement</h4></div></div></div><p>
                Appliance всегда имеет встроенный пакет, называемый OTRSApplianceManagement,
для выполнения функций по его администрированию. До выполнения операции
"drop" для базы данных, необходимо загрузить пакет OTRSApplianceManagement.
            </p><p>
                Перейдите в менеджер пакетов вашего appliance.
            </p><p>
                Выберите пакет OTRSApplianceManagement  и загрузите его.
            </p><p>
                </p><div class="screenshot"><div><img src="screenshots/win-download-appliance-package.png"></div></div><p>
            </p><p>
                Нам еще понадобится этот пакет после переноса системы под Windows в новую.
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="stop-all-otrs-services"></a>Остановите сервисы OTRS</h4></div></div></div><p>
                Остановите работающие сервисы appliance:
            </p><p>
                </p><pre class="screen">
shell&gt; service cron stop
shell&gt; service apache2 stop
shell&gt; su - otrs
shell&gt; cd /opt/otrs/
shell&gt; bin/Cron.sh stop
shell&gt; bin/otrs.Scheduler.pl -a stop
shell&gt; exit
                </pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="id-1.4.6.3.7"></a>Сделайте "drop" существующей БД вашего appliance, чтобы иметь пустую базу
для клонирования данных</h4></div></div></div><p>
                Скрипт OTRSCloneDB не удаляет данные в существующей базе OTRS в appliance,
поэтому придется это сделать вручную:
            </p><p>
                Замените пользователя на пользователя postgresql: </p><pre class="screen">
shell&gt; su - postgres
                </pre><p>
            </p><p>
                Очистите существующую БД otrs: </p><pre class="screen">
shell&gt; dropdb otrs
                </pre><p>
            </p><p>
                Создайте новую БД OTRS для пользователя otrs: </p><pre class="screen">
shell&gt; createdb --owner=otrs --encoding=utf8 otrs
                </pre><p>
            </p><p>
                Верните пользователя root: </p><pre class="screen">
shell&gt; exit
                </pre><p>
            </p><p>
                </p><div class="screenshot"><div><img src="screenshots/win-empty-db-appliance.png"></div></div><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="get-password-of-otrs-database"></a>Получить пароль postgresql вашей БД</h4></div></div></div><p>
                Перейдите в каталог OTRS вашего appliance:
            </p><p>
                </p><pre class="screen">
shell&gt; cd /opt/otrs
                </pre><p>
            </p><p>
                и давайте посмотрим на конфигурационный файл вашей appliance системы:
            </p><p>
                </p><pre class="screen">
shell&gt; less Kernel/Config.pm
                </pre><p>
            </p><p>
                Вы найдете пароль для вашей БД если немного пролистаете файл вниз:
            </p><p>
                </p><div class="screenshot"><div><img src="screenshots/win-gather-db-data-1.png"></div></div><p>
            </p><p>
                В нашем примере:
            </p><p>
                </p><pre class="screen">
I88cm34A1B6xrl3
                </pre><p> Запишите пароль, где-нибудь.
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="clone-database-to-remote-appliance"></a>Скопируйте вашу БД на удаленный appliance</h4></div></div></div><p>
                Переключитесь обратно на систему под Windows и откройте меню
администрирования SysConfig.
Выберите группу "OTRSCloneDB" и подгруппу "Configuration":
            </p><p>
                </p><div class="screenshot"><div><img src="screenshots/win_configurate_otrsclonedb_sysconfig-1.png"></div></div><p>
            </p><p>
                Нужно настроить параметр SysConfig - OTRSCloneDB::TargetSettings, со
следующими значениями:
            </p><p>
                </p><pre class="screen">
TargetDatabaseHost =&gt; 192.168.137.20 (Здесь надо ввести ip address вашего appliance)
TargetDatabase =&gt; otrs
TargetDatabaseUser =&gt; otrs
TargetDatabasePw =&gt; I88cm34A1B6xrl3 (Здесь надо указать password вашего appliance)
TargetDatabaseType =&gt; postgresql
                </pre><p>
            </p><p>
                </p><div class="screenshot"><div><img src="screenshots/win-configurate-otrsclonedb-sysconfig-2.png"></div></div><p>
            </p><p>
                Для запуска скрипта OTRSCloneDB необходимо переключиться в режим командной
строки в вашей Windows otrs системе в корневой каталог:
            </p><p>
                </p><pre class="screen">
shell&gt; cd "C:\otrs"
                </pre><p>
            </p><p>
                Если вы используете StrawberryPerl, то, возможно, потребуется активировать
оболочку perl:
            </p><p>
                </p><pre class="screen">
shell&gt; StrawberryPerl\portableshell.bat
                </pre><p>
            </p><p>
                </p><div class="screenshot"><div><img src="screenshots/win-run-otrsclonedb-1.png"></div></div><p>
            </p><p>
                Скрипт OTRSCloneDB  расположен в каталоге bin каталога otrs.
            </p><p>
                </p><pre class="screen">
shell&gt; cd "OTRS\bin"
                </pre><p>
            </p><p>
                Запуск скрипта OTRSCloneDB:
            </p><p>
                </p><pre class="screen">
shell&gt; perl otrs.OTRSCloneDB.pl
                </pre><p>
            </p><p>
                Теперь вы можете увидеть некоторую информацию о скрипте и его параметрах.
            </p><p>
                </p><div class="screenshot"><div><img src="screenshots/win-run-otrsclonedb-2.png"></div></div><p>
            </p><p>
                Внимание... Ошибки которые появляются при запуске без параметров говорят о
неверном имени входа для БД или проблемами с подключением к СУБД.
            </p><p>
                Если ошибок не получено, проверьте, что чистый запуск успешен:
            </p><p>
                </p><pre class="screen">
shell&gt; perl otrs.OTRSCloneDB.pl -n
                </pre><p>
            </p><p>
                </p><div class="screenshot"><div><img src="screenshots/win-run-otrsclonedb-3.png"></div></div><p>
            </p><p>
                Начните копирование вашей БД и "молитесь":
            </p><p>
                </p><pre class="screen">
shell&gt; perl otrs.OTRSCloneDB.pl -r
                </pre><p>
            </p><p>
                Пример успешного выполнения выглядит так:
            </p><p>
                </p><pre class="screen">
Generating DDL for OTRS.
Generating DDL for package OTRSCloneDB.
Creating structures in target database (phase 1/2)
...
...
Creating structures in target database (phase 2/2)
...
done.
                </pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="copy-otrs-base-files-to-remote-appliance"></a>Скопируйте следующие файлы из вашей windows системы в appliance</h4></div></div></div><p>
                Необходимо скопировать некоторые файлы из старой системы. Это можно сделать,
например, с помощью "WinSCP" (можно найти в интернете по фразе
"WinSCP"). Скопируйте следующие файлы:
            </p><p>
                </p><pre class="screen">
C:/otrs/OTRS/Kernel/Config/GenericAgent.pm
C:/otrs/OTRS/Kernel/Config/Files/ZZZAuto.pm
C:/otrs/OTRS/var/article/*
C:/otrs/OTRS/var/log/TicketCounter.log
                </pre><p>
            </p><p>
                в ваш appliance:
            </p><p>
                </p><pre class="screen">
/opt/otrs/Kernel/Config/GenericAgent.pm
/opt/otrs/Kernel/Config/Files/ZZZAuto.pm
/opt/otrs/var/article/*
/opt/otrs/var/log/TicketCounter.log
                </pre><p> Откройте файл
/opt/otrs/Kernel/Config/Files/ZZZAuto.pm в appliance системе и замените все
пути  типа "C:/otrs/OTRS/" на "/opt/otrs/"!
            </p><p>
                Если вы вручную правили  Kernel/Config.pm - скопируйте сделанные изменения в
систему с appliance. Не копируйте целиком, т.к. в новой системе другие
настройки БД и пути к файлам!
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="reinstall-packages-install-otrs-appliance-management"></a>Переустановите все пакеты и установите OTRSApplianceManagement</h4></div></div></div><p>
                Переустановите все пакеты, чтобы вернуть все пользовательские файлы и
установите потерянный пакет appliance management, который вы загрузили до
этого.
            </p><p>
                Скопируйте вашу резервную копию OTRSApplianceManagement-1.0.4.opm в корневой
каталог OTRS в /opt/otrs.
            </p><p>
                </p><pre class="screen">
shell&gt; bin/otrs.SetPermissions.pl --otrs-user=otrs --otrs-group=otrs --web-user=www-data --web-group=www-data /opt/otrs
shell&gt; su - otrs
shell&gt; cd /opt/otrs
shell&gt; perl bin/otrs.DeleteCache.pl
shell&gt; perl bin/otrs.LoaderCache.pl -o delete
shell&gt; perl bin/otrs.PackageManager.pl -a reinstall-all
shell&gt; perl bin/otrs.PackageManager.pl -a install -p OTRSApplianceManagement-1.0.4.opm
shell&gt; exit
                </pre><p>
            </p><p>
                Исправить все права в вашей OTRS системе снова:
            </p><p>
                </p><pre class="screen">
shell&gt; bin/otrs.SetPermissions.pl --otrs-user=otrs --otrs-group=otrs --web-user=www-data --web-group=www-data /opt/otrs
                </pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="disable-remote-access-for-appliance-database"></a>Выключите удаленный доступ к базам postgresql вашей appliance</h4></div></div></div><p>
                Выполните обратно все шаги, сделанные при включении удаленного доступа к
базам postgresql вашей appliance
            </p><p>
                Смените каталог на postgresql:
            </p><p>
                </p><pre class="screen">
shell&gt; cd /etc/postgresql/8.4/main
shell&gt; vi postgresql.conf
                </pre><p>
            </p><p>
                Удалите следующую строку в конеце файла:
            </p><p>
                </p><pre class="screen">
listen_addresses = '*'
                </pre><p>
            </p><p>
                Сохраните файл.
            </p><p>
                </p><pre class="screen">
shell&gt; vi pg_hba.conf
                </pre><p>
            </p><p>
                Удалите следующую строку в конеце файла:
            </p><p>
                </p><pre class="screen">
host all all  0.0.0.0/0 md5
                </pre><p>
            </p><p>
                Сохраните файл.
            </p><p>
                Перезапустите сервер postgresql
            </p><p>
                </p><pre class="screen">
shell&gt; service postgresql restart
                </pre><p>
            </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="start-all-otrs-services"></a>Запуск сервисов OTRS </h4></div></div></div><p>
                Запустите сервисы вашего appliance:
            </p><p>
                </p><pre class="screen">
shell&gt; service cron start
shell&gt; service apache2 start
shell&gt; su - otrs
shell&gt; cd /opt/otrs/
shell&gt; bin/Cron.sh start
shell&gt; bin/otrs.Scheduler.pl -a start
                </pre><p>
            </p><p>
                Теперь вы можете войти в ваше приложение OTRS в appliance в браузере и
работать с импортированными данными из старой системы на Windows.
            </p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="web-installer.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="installation.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="upgrading.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Использование веб установщика </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Обновление с 3.3 до 4</td></tr></table></div></body></html>
